var Promise = require("promise");

function Database()
{
  this.entries = [];
};

Database.prototype =
{
  insert: function(key, value)
  {
    this.entries.push({ key: key, value: value, stats: { hits: 0 } });
  },
  
  find: function(key)
  {
    var scores = new Array(this.entries.length);
    scores.fill(0);
    
    this.entries.forEach(function(item, i)
    {
      var dbKey = item.key;
      var properties = Object.keys(dbKey);
      properties.forEach(function(name)
      {
        if(dbKey[name] == key[name] && typeof dbKey[name] != undefined)
          scores[i]++;
      });
    });
    
    var maxScore = Math.max.apply(Math, scores);
    if(maxScore > 1)
    {
      var maxScoreIndex = scores.indexOf(maxScore);
      this.entries[maxScoreIndex].stats.hits++;
      return this.entries[maxScoreIndex];
    }
    else
    {
      return null;
    }
  },
  
  modifyStats: function(key, cb)
  {
    var entry = this.entries.find(function(x) { return key == x.key; });
    if(entry)
      cb(entry.stats);
  }
};

module.exports = exports = Database;
